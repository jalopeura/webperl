--- Makefile.PL.orig	2023-11-16 16:46:01.000000000 -0800
+++ Makefile.PL	2023-11-16 16:46:43.000000000 -0800
@@ -56,13 +56,13 @@
 # Because DBI generates a postamble at configure-time, we need
 # the required version of DBI very early.
 my $DBI_required = 1.57;
-eval {
-	require DBI;
-};
-if ( $@ or DBI->VERSION < $DBI_required ) {
-	print "DBI $DBI_required is required to configure this module; please install it or upgrade your CPAN/CPANPLUS shell.\n";
-	exit(0);
-}
+#eval {
+#	require DBI;
+#};
+#if ( $@ or DBI->VERSION < $DBI_required ) {
+#	print "DBI $DBI_required is required to configure this module; please install it or upgrade your CPAN/CPANPLUS shell.\n";
+#	exit(0);
+#}
 
 # See if we have a C compiler
 # The following code is adapted from Module::Install::Can
@@ -221,7 +221,7 @@
 
 my @CC_INC = (
 	'-I.',
-	'-I$(DBI_INSTARCH_DIR)',
+	'-I../../lib/auto/DBI',
 );
 if ( $sqlite_inc ) {
 	push @CC_INC, "-I$sqlite_inc";
@@ -420,11 +420,25 @@
 use Config;
 
 sub postamble {
-	require DBI;
-	require DBI::DBD;
-	my $postamble = eval {
-		DBI::DBD::dbd_postamble(@_)
-	};
+	my $dbi_instarch_dir = '../../lib/auto/DBI';
+	my $dbi_driver_xst = "$dbi_instarch_dir/Driver.xst";
+	my $xstf_h = "$dbi_instarch_dir/Driver_xst.h";
+	my $postamble = '
+# --- This section was generated by DBI::DBD::dbd_postamble()
+DBI_INSTARCH_DIR='.$dbi_instarch_dir.'
+DBI_DRIVER_XST='.$dbi_driver_xst.'
+
+# The main dependency (technically correct but probably not used)
+$(BASEEXT).c: $(BASEEXT).xsi
+
+# This dependency is needed since MakeMaker uses the .xs.o rule
+$(BASEEXT)$(OBJ_EXT): $(BASEEXT).xsi
+
+$(BASEEXT).xsi: $(DBI_DRIVER_XST) '.$xstf_h.'
+	$(PERL) -p -e "s/~DRIVER~/$(BASEEXT)/g" $(DBI_DRIVER_XST) > $(BASEEXT).xsi
+
+# ---
+';
     if (-e 'sqlite3.c' && -e 'sqlite3.h' && -e 'sqlite3ext.h') {
 		my $S = $^O eq 'MSWin32' ? '\\' : '/';  # only Win32 (not cygwin)
 		my $share = "\$(INST_LIB)${S}auto${S}share${S}dist${S}\$(DISTNAME)";
